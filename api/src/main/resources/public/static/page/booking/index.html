<div class="wrapper-md" style="padding-top:0!important;" ng-controller="BookIndexController">

    <div class="panel panel-default">
        <div class="panel-heading">
            实验列表
        </div>
        <div class="row wrapper">
            <div class="col-sm-6 m-b-xs">
                <label class="inline">选择课程</label>
                <div class="dropdown filter-content inline" dropdown="">
                    <button class="btn btn-default dropdown-toggle filter-a" type="button" dropdown-toggle=""
                       aria-haspopup="true"
                       aria-expanded="false">{{filterCourse.name}}<span
                            class="caret"></span>
                    </button>
                    <ul class="dropdown-menu">
                        <li ng-repeat="course in courses">
                            <a href="javascript:void(0)" ng-click="changeCourse(course)">
                                {{course.name}}
                            </a>
                        </li>
                    </ul>
                </div>
            </div>
            <div class="col-sm-4">
            </div>
            <div class="col-sm-2">
            </div>
        </div>
        <div class="table-responsive">
            <table class="table table-striped b-t b-light">
                <thead>
                <tr>
                    <th>实验项目</th>
                    <th>实验地点</th>
                    <th>开放周次</th>
                    <th style="width:30px;"></th>
                </tr>
                </thead>
                <tbody>
                <tr ng-repeat="item in items">
                    <td>{{item.name}}</td>
                    <td>{{item.place}}</td>
                    <td>{{item.opentime}}</td>
                    <td>
                        <button class="btn btn-default  btn-success btn-xs" ui-sref="app.booking.booking({itemId: '{{item.id}}'})">预约情况</button>
                    </td>
                </tr>
                </tbody>
            </table>
        </div>
        <footer class="panel-footer">
            <div class="row">
                <div class="col-sm-4 hidden-xs">
                </div>
                <div class="col-sm-4 text-center">
                    <small class="text-muted inline m-t-sm m-b-sm"></small>
                </div>
                <div class="col-sm-4 text-right text-center-xs">
                    <ul class="pagination pagination-sm m-t-none m-b-none">
                        <li><a href><i class="fa fa-chevron-left"></i></a></li>
                        <li><a href>1</a></li>
                        <li><a href>2</a></li>
                        <li><a href>3</a></li>
                        <li><a href>4</a></li>
                        <li><a href>5</a></li>
                        <li><a href><i class="fa fa-chevron-right"></i></a></li>
                    </ul>
                </div>
            </div>
        </footer>
    </div>

</div>

<script type="text/javascript">


    app.controller('BookIndexController', ['$scope', '$http', function ($scope, $http) {
        $scope.filterCourses = [];

        $scope.getCourses = function () {
            var url = $scope.app.host + '/course/page';

            var params = {};
            console.log(url + "?" + JSON.stringify(params));
            $http.post(url, params)
                    .success(function (response) {
                        console.log(response);
                        $scope.courses = response.pager.courses;
                        if ($scope.courses.length !=0) {
                            $scope.filterCourse = $scope.courses[0];
                            $scope.getItems();
                            console.log("0");

                        };

                    }).error(function (response) {
                        toaster.pop("error", "错误", response.error.message);
                    });
        };
        $scope.getCourses();

        $scope.changeCourse = function (course) {
            console.log("change");
            $scope.filterCourse = course;
            $scope.getItems();
        };

       $scope.getItems = function () {
           var url = $scope.app.host + '/item/page';

           var params = {"courseId": $scope.filterCourse.id};
           console.log(url + "?" + JSON.stringify(params));
           $http.post(url, params)
                   .success(function (response) {
                       console.log(response);
                       $scope.items = response.pager.items;

                   }).error(function (response) {
                       $scope.pop("error", "错误", response.error.message);
                   });
       };

    }]);

</script>